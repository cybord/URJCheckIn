
<h2 id="maintitle">Clases de {{subject}} <br/>
	<small>Accede a la informaci&oacute;n de las clases</small>
</h2>

<!-- Descripcion de la asignatura o seminario -->
<div id="subject_info" class="row">
	<dl class="dl-horizontal col-xs-12 fields">
		<div class="span2 well">
			<dt>Nombre: </dt> <dd>{{subject.name}} </dd>
			{% if not subject.is_seminar %}
				<dt>N&uacute;mero de alumnos: </dt> <dd>{{subject.n_students}} </dd>
			{% endif %}
			<dt>Grado{{subject.degrees.all|length|pluralize}}: </dt>
			<dd>
				<ul id="degrees_list">
					{%for degree in subject.degrees.all%}
						<li>
							{{degree.name}}
						</li>
					{% empty %}
						La asignatura no est&aacute; vinculada con ning&uacute;n grado.
					{%endfor%}
				</ul>
			</dd>
			<dt>Profesor{{profesors|length|pluralize:"es"}}: </dt>
			<dd>
				<ul id="profesor_list">
					{%for prof in profesors%}
						<li id="professor_{{prof.user.id}}">
							<a onClick="ask_ajax_page('/profile/view/{{prof.user.id}}',
							 loadAjaxPage); return false;"
							 href="/profile/view/{{prof.user.id}}">
								{{prof.user.first_name}} {{prof.user.last_name}}
							</a>
						</li>
					{% empty %}
						La asignatura no es impartida por ning&uacute;n profesor.
					{%endfor%}
				</ul>
			</dd>
			{% if subject.is_seminar %}
				<dt>Plazas ocupadas: </dt> 
				<dd>
					<span id="n_students">{{subject.n_students}}</span>/{{subject.max_students}}
				</dd>
				<dt>Descripci&oacute;n: </dt> <dd>{{subject.description}}</dd>

				<div id="alert_change_sign">
					{% if error %}
						<div class="row">
							<div class="col-sm-10 col-sm-offset-1">
								<div class="alert alert-danger">
									{{error}}
								</div>
							</div>
						</div>
					{% endif %}
				</div>
				{% if not started %}
				<!-- Si aun no ha empezado los alumnos pueden apuntarse/desapuntarse si hay plaza
					y los profesores pueden apuntarse como ponentes -->
				<!-- Si se cambian los botones hay que cambiar el javascript subject.js -->
					{% if profile.is_student %}
						{% if signed %}
							<div class="row">
								<form name="sign_seminar" action="" method="POST" id="sign_seminar"
										 onsubmit="changeSignSeminar(); return false;">
									{% csrf_token %}
									<button id="sign_button" class="btn btn-danger btn-block">
										<span class="glyphicon glyphicon-remove-circle"></span> Desapuntarme
									</button>
								</form>
							</div>
						{% elif subject.n_students < subject.max_students %}			
							<div class="row">
								<form name="sign_seminar" action="" method="POST" id="sign_seminar"
									 onsubmit="changeSignSeminar(); return false;">
									{% csrf_token %}
									<button id="sign_button" class="btn btn-success btn-block">
										<span class="glyphicon glyphicon-ok-circle"></span> Apuntarme
									</button>
								</form>
							</div>
						{% endif %}
					{% else %}
						<div class="row">
							<form name="sign_seminar" action="" method="POST" id="sign_seminar"
								 onsubmit="changeSignSeminar(); return false;">
								{% csrf_token %}
								{% if signed %}
									<button id="sign_button" class="btn btn-danger btn-block">
										<span class="glyphicon glyphicon-remove-circle"></span> Dejar de ser organizador
									</button>
								{% else %}
									<button id="sign_button" class="btn btn-success btn-block">
										<span class="glyphicon glyphicon-ok-circle"></span> Hacerme organizador
									</button>
								{% endif %}
							</form>
						</div>
					{% endif %}
				{% endif %}
			{% endif %}
		</div>
	</dl>
</div>


{% if not profile.is_student %}
	<div class="row" id="professor_options" {% if not signed %} hidden {% endif %}>
		<div class="col-xs-12 col-md-6" id="check_attendance">
			<a onClick="ask_ajax_page('/subjects/{{subject.id}}/attendance', loadAjaxPage);
			 return false;" href="{{subject.id}}/attendance" class="btn btn-info btn-block">
				<span class="glyphicon glyphicon-user"></span> Comprobar asistencia
			</a>
		</div>
		<div class="col-xs-12 col-md-6" id="new_subject">
			<a onClick="ask_ajax_page('/subjects/{{subject.id}}/new_class', loadAjaxPage);
			 return false;" href="{{subject.id}}/new_class" class="btn btn-warning btn-block">
				<span class="glyphicon glyphicon-cog"></span> Crear clases
			</a>
		</div>
		{% if request.user == subject.creator %}
			<div class="col-xs-12 col-md-6" id="config_subject">
				<a onClick="ask_ajax_page('/subjects/{{subject.id}}/edit', loadAjaxPage);
				 return false;" href="{{subject.id}}/edit" class="btn btn-warning btn-block">
					<span class="glyphicon glyphicon-pencil"></span> Gesti&oacute;n 
					{% if subject.is_seminar %}del seminario{% else %}de la asignatura{% endif %}
				</a>
			</div>
		{% endif %}
	</div>
{% endif %}

<!-- Clases de la asignatura o seminario -->
<div id="classes">
	{%if classes_n%}
	<!-- Clases realizandose en este momento -->
	<div class="row">
		<div class="col-xs-12">
			<div class="panel panel-danger">
				<div class="panel-heading">
					<h3 class="panel-title">Clases imparti&eacute;ndose</h3>
				</div>
				<ul class="subjects_list list-group classes_list">
					{% for class in classes_n %}
						<a href="/class/{{class.id}}" class="list-group-item ajax">
							{{class.start_time|date:'d-m-Y H:i'}}/{{class.end_time|date:'H:i'}}
						</a>
					{% endfor %}
				</ul>
			</div>
		</div>
	</div>
	{%endif%}

	<div class="row">
		<!-- Clases que aun no se han realizado -->
		<div class="col-sm-6">
			<div class="panel panel-info">
				<div class="panel-heading">
					<h3 class="panel-title">Pr&oacute;ximas clases</h3>
				</div>
				{% if classes_f.has_previous %}
					<!-- Solo para cuando estemos en otra pagina, si hemos llegado alli 
						no ha sido con javascript-->
					<a class="btn btn-primary btn-sm btn-block" role="button"
						href="?page={{classes_f.previous_page_number}}">
						<span class="glyphicon glyphicon-refresh"></span>
						Clases m&aacute;s cercanas
					</a>
				{% endif %}
				<ul id="future_lessons" class="list-group classes_list">
					{% for class in classes_f%}
						<a onClick="ask_ajax_page('/class/{{class.id}}', loadAjaxPage);
						 return false;" href="/class/{{class.id}}" class="list-group-item">
							{{class.start_time|date:'d-m-Y H:i'}}/{{class.end_time|date:'H:i'}}
							 dentro de {{ class.start_time|timeuntil }}
						</a>
					{%empty%}
						<li class="list-group-item">No hay clases programadas</li>
					{% endfor %}
				</ul>
				<div class="panel-footer">
					{% if classes_f.has_next %}
						<a id="ask_newer" href="?page={{classes_f.next_page_number}}" 
							class="btn btn-primary btn-sm btn-block" role="button"
							{% with classes_f|last as last_class %}
								onClick="askLessons({{last_class.id}}, true); return false;">
							{% endwith %}
							<span class="glyphicon glyphicon-refresh"></span> Siguientes clases
						</a>
					{% else %}
						<div class="btn btn-primary btn-sm btn-block disabled">
							No hay m&aacute;s clases
						</div>
					{% endif %}
				</div>
			</div>
		</div>
		<!-- Clases que ya se han realizado -->
		<div class="col-sm-6">
			<div class="panel panel-success">
				<div class="panel-heading">
					<h3 class="panel-title">&Uacute;ltimas clases</h3>
				</div>
				{% if classes_p.has_previous %}
					<!-- Solo para cuando estemos en otra pagina, si hemos llegado alli 
						no ha sido con javascript-->
					<a class="btn btn-primary btn-sm btn-block" role="button"
						href="?page={{classes_p.previous_page_number}}">
						<span class="glyphicon glyphicon-refresh"></span>
						Clases m&aacute;s recientes
					</a>
				{% endif %}
				<ul id="past_lessons" class="list-group classes_list">
					{% for class in classes_p %}
						<a onClick="ask_ajax_page('/class/{{class.id}}', loadAjaxPage);
						 return false;" href="/class/{{class.id}}" class="list-group-item">
							{{class.start_time|date:'d-m-Y H:i'}}/{{class.end_time|date:'H:i'}}
						</a>
					{%empty%}
						<li class="list-group-item">Todav&iacute;a no ha habido clases</li>
					{% endfor %}
				</ul>
				<div class="panel-footer">
					{% if classes_p.has_next %}
						<a id="ask_older" href="?page={{classes_p.next_page_number}}" 
							class="btn btn-primary btn-sm btn-block" role="button"
							{% with classes_p|last as last_class %}
								onClick="askLessons({{last_class.id}}, false); return false;">
							{% endwith %}
							<span class="glyphicon glyphicon-refresh"></span> Clases anteriores
						</a>
					{% else %}
						<div class="btn btn-primary btn-sm btn-block disabled">
							No hay m&aacute;s clases
						</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
</div>
